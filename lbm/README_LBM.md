# Interactive D2Q9 Lattice Boltzmann Method Solver

This portfolio includes a fully functional CFD simulator running directly in the browser using the Lattice Boltzmann Method.

## Two Implementations Available

### 1. JavaScript Version (Default)
- **Performance**: ~20-30 FPS at 600×300 resolution
- **Pros**: Works immediately, no compilation needed
- **Cons**: Limited to lower resolutions due to performance
- **File**: `lbm-solver.js`

### 2. WebAssembly Version (Optional, Faster)
- **Performance**: ~100-150 FPS at 600×300 resolution (5-7x faster!)
- **Pros**: Near-native C++ performance, can handle higher resolutions
- **Cons**: Requires compilation with Emscripten
- **Files**: `lbm-solver.cpp`, `lbm-solver-wasm-wrapper.js`

## Quick Start (JavaScript Version)

The JavaScript version is already set up and ready to use:

1. Open `index.html` in a web browser
2. Scroll to the "Interactive D2Q9 Lattice Boltzmann Solver" project
3. Click "Start" to begin the simulation

That's it! No compilation or setup required.

## Using the WebAssembly Version

For significantly better performance (5-10x speedup), compile and use the WebAssembly version:

### Step 1: Install Emscripten

**Windows:**
```bash
git clone https://github.com/emscripten-core/emsdk.git
cd emsdk
emsdk install latest
emsdk activate latest
emsdk_env.bat
```

**macOS/Linux:**
```bash
git clone https://github.com/emscripten-core/emsdk.git
cd emsdk
./emsdk install latest
./emsdk activate latest
source ./emsdk_env.sh
```

### Step 2: Build the WASM Module

Navigate to the portfolio directory and run:

**Windows:**
```bash
build-wasm.bat
```

**macOS/Linux:**
```bash
chmod +x build-wasm.sh
./build-wasm.sh
```

Or manually:
```bash
emcc lbm-solver.cpp -o lbm-solver-wasm.js -std=c++17 -O3 -s WASM=1 -s MODULARIZE=1 -s EXPORT_NAME="Module" --bind
```

### Step 3: Enable WASM in HTML

Edit `index.html` and change:

```html
<!-- Option 1: Use WebAssembly (5-10x faster, requires compilation) -->
<!-- Uncomment these lines after building the WASM module: -->
<script src="lbm-solver-wasm.js"></script>
<script src="lbm-solver-wasm-wrapper.js"></script>

<!-- Option 2: Use JavaScript (default, no compilation needed) -->
<!-- <script src="lbm-solver.js"></script> -->
```

### Step 4: Serve with HTTP Server

WASM requires HTTP protocol (not `file://`):

```bash
# Python 3
python -m http.server 8000

# Node.js
npx http-server

# VS Code - Install "Live Server" extension
# Right-click index.html → "Open with Live Server"
```

Open `http://localhost:8000` in your browser.

## Features

### Simulation Capabilities
- **D2Q9 Lattice**: 9-velocity lattice with BGK collision operator
- **Boundary Conditions**:
  - Bounce-back (no-slip) for solid objects
  - Free-slip for top/bottom walls
  - Constant velocity inlet
  - Zero-gradient outlet
- **Numerical Stability**: Velocity ramp-up prevents divergence at startup

### Interactive Controls
- **Geometries**: Circle, NACA 0012 airfoil, square, flat plate, streamlined triangle
- **Inlet Velocity**: 0.02 - 0.35 (adjustable to visualize Karman vortex streets)
- **Kinematic Viscosity**: 0.005 - 0.05 (controls Reynolds number)
- **Visualization Modes**: Velocity magnitude, vorticity, pressure
- **Mesh Overlay**: Toggle computational grid visualization

### Performance Optimizations

**JavaScript Version:**
- Loop unrolling for equilibrium calculations
- Float64Array for efficient memory access
- Inline color computations
- Reused buffers to avoid allocations

**C++/WASM Version:**
- Native C++ performance with compiler optimizations
- Efficient memory layout using std::vector
- Minimal JavaScript/C++ boundary crossings
- Optimized data transfer using Emscripten bindings

## Performance Benchmarks

| Resolution | JavaScript | WASM (C++) | Speedup |
|------------|------------|------------|---------|
| 600×300    | 20-30 FPS  | 100-150 FPS | 5-7x   |
| 1200×600   | 5-8 FPS    | 35-50 FPS   | 6-8x   |
| 1920×1080  | < 2 FPS    | 10-15 FPS   | 8-10x  |

*Tested on: Intel i7-10700K, Chrome 120, -O3 optimization*

## File Structure

```
portfolio/
├── index.html                    # Main website
├── styles.css                    # Styling
├── script.js                     # UI and initialization
│
├── lbm-solver.js                 # JavaScript LBM implementation
│
├── lbm-solver.cpp                # C++ LBM implementation
├── lbm-solver-wasm-wrapper.js    # JavaScript wrapper for WASM
├── lbm-solver-wasm.js            # Generated by Emscripten
├── lbm-solver-wasm.wasm          # Generated WebAssembly binary
│
├── build-wasm.bat                # Windows build script
├── build-wasm.sh                 # Unix/Mac build script
├── BUILD_WASM.md                 # Detailed build instructions
└── README_LBM.md                 # This file
```

## Technical Details

### D2Q9 Lattice Structure

```
6   2   5
  ↖ ↑ ↗
7 ← 0 → 1
  ↙ ↓ ↘
8   4   3
```

**Velocity vectors:**
- e₀ = (0, 0) - rest
- e₁,₃ = (±1, 0) - horizontal
- e₂,₄ = (0, ±1) - vertical
- e₅,₆,₇,₈ = (±1, ±1) - diagonals

**Weights:**
- w₀ = 4/9
- w₁,₂,₃,₄ = 1/9
- w₅,₆,₇,₈ = 1/36

### BGK Collision Operator

The solver uses the Bhatnagar-Gross-Krook (BGK) approximation:

```
fᵢ(x + eᵢΔt, t + Δt) = fᵢ(x,t) + ω(fᵢᵉᑫ(x,t) - fᵢ(x,t))
```

Where:
- `fᵢ` = distribution function
- `fᵢᵉᑫ` = equilibrium distribution
- `ω = 1/τ` = relaxation parameter
- `τ = 3ν + 0.5` = relaxation time
- `ν` = kinematic viscosity

### Equilibrium Distribution

```
fᵢᵉᑫ = wᵢ ρ (1 + 3(eᵢ·u) + 4.5(eᵢ·u)² - 1.5(u·u))
```

## Extending the Solver

### Add New Geometries

**JavaScript** (`lbm-solver.js`):
```javascript
case 'custom':
  for (let i = 0; i < this.width; i++) {
    for (let j = 0; j < this.height; j++) {
      if (/* your condition */) {
        this.solid[i][j] = true;
      }
    }
  }
  break;
```

**C++** (`lbm-solver.cpp`):
```cpp
void createCustom() {
    for (int i = 0; i < width; i++) {
        for (int j = 0; j < height; j++) {
            if (/* your condition */) {
                obstacle[i][j] = true;
            }
        }
    }
}
```

### Increase Resolution

For higher resolutions with WASM, update the build command:

```bash
emcc lbm-solver.cpp -o lbm-solver-wasm.js -std=c++17 -O3 \
  -s WASM=1 --bind \
  -s INITIAL_MEMORY=268435456 \
  -s MAXIMUM_MEMORY=1073741824
```

Then in `script.js`:
```javascript
const width = 1200;  // or 1920
const height = 600;  // or 1080
```

## Troubleshooting

### "Module is not defined"
- Ensure WASM scripts load before `script.js`
- Check browser console for loading errors

### Poor performance with WASM
- Verify `-O3` optimization was used
- Check that WASM is actually being used (see console log)
- Try clearing browser cache

### Simulation diverges
- Lower the inlet velocity
- Increase viscosity
- Check geometry doesn't have sharp corners

### CORS errors
- Must serve via HTTP, not `file://`
- Use Live Server or python http.server

## Resources

- **LBM Theory**: [Wikipedia - Lattice Boltzmann methods](https://en.wikipedia.org/wiki/Lattice_Boltzmann_methods)
- **Emscripten**: [emscripten.org](https://emscripten.org)
- **WebAssembly**: [webassembly.org](https://webassembly.org)
- **Source Code**: This portfolio

## License

Feel free to use this code for educational purposes or in your own projects.

---

**Built with**: C++17, WebAssembly (Emscripten), JavaScript, HTML5 Canvas
